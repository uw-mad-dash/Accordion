The code borrows a lot of structure from Thijs Vogels code for powerSGD.
https://github.com/epfml/powersgd
